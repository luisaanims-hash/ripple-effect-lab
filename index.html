<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>The Ripple Effect Lab</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        body {
            background: linear-gradient(to bottom, #1a3a5f, #2c5f8a);
            color: #fff;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 10px;
        }

        header {
            text-align: center;
            margin-bottom: 15px;
            width: 100%;
        }

        h1 {
            font-size: 2.2rem;
            margin-bottom: 8px;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.5);
        }

        .subtitle {
            font-size: 1.1rem;
            margin-bottom: 15px;
            opacity: 0.9;
        }

        .container {
            display: flex;
            flex-direction: column;
            width: 100%;
            max-width: 1400px;
            height: 85vh;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 15px;
            overflow: hidden;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
        }

        .screen {
            display: none;
            flex-direction: column;
            height: 100%;
            padding: 15px;
        }

        .active {
            display: flex;
        }

        /* Introduction Screen Styles */
        #introduction-screen {
            align-items: center;
            justify-content: center;
            text-align: center;
        }

        .intro-content {
            max-width: 800px;
            background: rgba(255, 255, 255, 0.15);
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 20px;
        }

        .intro-content h2 {
            font-size: 2rem;
            margin-bottom: 20px;
            color: #4da8da;
        }

        .intro-content p {
            font-size: 1.1rem;
            line-height: 1.6;
            margin-bottom: 15px;
            text-align: left;
        }

        .intro-content ul {
            text-align: left;
            margin: 20px 0;
            padding-left: 20px;
        }

        .intro-content li {
            margin-bottom: 10px;
            line-height: 1.5;
        }

        .highlight {
            color: #4da8da;
            font-weight: bold;
        }

        .start-lab-btn {
            background: #27ae60;
            color: white;
            border: none;
            padding: 15px 40px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1.2rem;
            transition: all 0.3s ease;
            margin-top: 20px;
        }

        .start-lab-btn:hover {
            background: #219653;
            transform: translateY(-3px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
        }

        /* Start Screen Styles */
        #start-screen {
            align-items: center;
            justify-content: center;
            text-align: center;
        }

        .scenario-list {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            width: 100%;
            margin-top: 30px;
        }

        .scenario-card {
            background: rgba(255, 255, 255, 0.15);
            border-radius: 10px;
            padding: 20px;
            cursor: pointer;
            transition: all 0.3s ease;
            border: 2px solid transparent;
        }

        .scenario-card:hover {
            background: rgba(255, 255, 255, 0.25);
            transform: translateY(-5px);
            border-color: #4da8da;
        }

        .scenario-card h3 {
            font-size: 1.5rem;
            margin-bottom: 10px;
        }

        .scenario-card p {
            opacity: 0.8;
            font-size: 0.9rem;
        }

        /* Pond Screen Styles - IMPROVED */
        #pond-screen {
            flex-direction: column;
        }

        .pond-area {
            display: flex;
            flex: 1;
            gap: 15px;
            margin-bottom: 10px;
            min-height: 0; /* Prevents overflow */
        }

        .pebbles-panel {
            width: 280px;
            background: rgba(0, 0, 0, 0.2);
            padding: 15px;
            border-radius: 10px;
            overflow-y: auto;
            flex-shrink: 0;
        }

        .pebbles-panel h2 {
            margin-bottom: 15px;
            text-align: center;
            font-size: 1.4rem;
        }

        .pebble-item {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 8px;
            padding: 12px;
            margin-bottom: 10px;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .pebble-item:hover {
            background: rgba(255, 255, 255, 0.2);
        }

        .pebble-item.active {
            background: rgba(77, 168, 218, 0.4);
            border-left: 4px solid #4da8da;
        }

        .pond-container {
            flex: 1;
            position: relative;
            background: linear-gradient(to bottom, #1e5799, #207cca);
            border-radius: 10px;
            overflow: hidden;
            display: flex;
            align-items: center;
            justify-content: center;
            min-height: 400px;
        }

        .pond {
            width: 100%;
            height: 100%;
            position: relative;
            overflow: visible;
        }

        .ripple {
            position: absolute;
            border-radius: 50%;
            border: 2px solid rgba(255, 255, 255, 0.7);
            transform: translate(-50%, -50%);
            pointer-events: none;
            opacity: 0;
        }

        .ripple-text {
            position: absolute;
            background: rgba(0, 0, 0, 0.85);
            color: white;
            padding: 12px 15px;
            border-radius: 8px;
            max-width: 280px;
            font-size: 0.85rem;
            pointer-events: none;
            opacity: 0;
            transition: opacity 0.3s;
            z-index: 10;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
            border-left: 4px solid #4da8da;
        }

        .ripple-text.active {
            opacity: 1;
        }

        .ripple-date {
            font-weight: bold;
            color: #4da8da;
            margin-bottom: 5px;
            font-size: 0.9rem;
        }

        .ripple-content {
            line-height: 1.4;
        }

        .timeline-connector {
            position: absolute;
            background: rgba(255, 255, 255, 0.5);
            height: 2px;
            pointer-events: none;
            z-index: 5;
            opacity: 0;
            transition: opacity 0.3s;
        }

        .timeline-connector.active {
            opacity: 0.6;
        }

        /* Controls */
        .controls {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin-top: 0;
            padding: 8px;
            flex-shrink: 0;
        }

        button {
            background: #4da8da;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 0.9rem;
            transition: all 0.2s ease;
            min-width: 120px;
        }

        button:hover {
            background: #3d8fc7;
            transform: translateY(-2px);
        }

        .reset-btn {
            background: #e74c3c;
        }

        .reset-btn:hover {
            background: #c0392b;
        }

        .exit-ticket-btn {
            background: #27ae60;
        }

        .exit-ticket-btn:hover {
            background: #219653;
        }

        /* Instructions */
        .instructions {
            margin-top: 8px;
            font-size: 0.8rem;
            opacity: 0.8;
            text-align: center;
            flex-shrink: 0;
        }

        /* Exit Ticket Screen Styles */
        #exit-ticket-screen {
            align-items: center;
            justify-content: flex-start;
        }

        .exit-ticket-container {
            background: rgba(255, 255, 255, 0.15);
            border-radius: 10px;
            padding: 30px;
            width: 100%;
            max-width: 800px;
            margin-top: 20px;
        }

        .exit-ticket-container h2 {
            text-align: center;
            margin-bottom: 25px;
            font-size: 1.8rem;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: bold;
        }

        .form-group input, .form-group textarea {
            width: 100%;
            padding: 12px;
            border-radius: 5px;
            border: 1px solid #ccc;
            font-size: 1rem;
            background: rgba(255, 255, 255, 0.9);
        }

        .form-group textarea {
            min-height: 200px;
            resize: vertical;
        }

        .exit-ticket-controls {
            display: flex;
            justify-content: space-between;
            margin-top: 25px;
        }

        /* Responsive Design */
        @media (max-width: 768px) {
            .pond-area {
                flex-direction: column;
            }
            
            .pebbles-panel {
                width: 100%;
                max-height: 200px;
            }
            
            .pond-container {
                min-height: 300px;
            }

            .controls {
                flex-wrap: wrap;
            }

            button {
                min-width: 100px;
                font-size: 0.8rem;
                padding: 6px 12px;
            }

            .ripple-text {
                max-width: 200px;
                font-size: 0.8rem;
            }
        }
    </style>
</head>
<body>
    <header>
        <h1>The Ripple Effect Lab</h1>
        <p class="subtitle">An Interactive Cause & Consequence Simulator</p>
    </header>

    <div class="container">
        <!-- Introduction Screen -->
        <div id="introduction-screen" class="screen active">
            <div class="intro-content">
                <h2>Welcome to The Ripple Effect Lab!</h2>
                <p>History isn't just a collection of dates and events—it's a complex web of <span class="highlight">causes and consequences</span> that ripple through time. In this interactive lab, you'll explore how single actions can create waves of change that transform societies, economies, and environments.</p>
                
                <p><span class="highlight">How does it work?</span></p>
                <ul>
                    <li><strong>Choose a historical scenario</strong> from periods like the Gilded Age, Great Depression, or modern challenges</li>
                    <li><strong>Drop "pebbles" (causes)</strong> into our virtual pond and watch the ripples unfold</li>
                    <li><strong>Follow the chain of consequences</strong> from immediate effects to long-term impacts</li>
                    <li><strong>Discover patterns</strong> that repeat across different historical periods</li>
                </ul>
                
                <p>By the end of this lab, you'll understand how solving one problem often creates new challenges—and how we can learn from history to make better decisions today.</p>
                
                <p><span class="highlight">Ready to see how your actions today might ripple into tomorrow?</span></p>
                
                <button class="start-lab-btn" id="start-lab-btn">Start Exploring History's Ripples</button>
            </div>
        </div>

        <!-- Start Screen -->
        <div id="start-screen" class="screen">
            <h2>Select a Historical Scenario</h2>
            <div class="scenario-list" id="scenario-list">
                <!-- Scenarios will be populated by JavaScript -->
            </div>
        </div>

        <!-- Pond Screen -->
        <div id="pond-screen" class="screen">
            <div class="pond-area">
                <div class="pebbles-panel">
                    <h2 id="scenario-title">Scenario Title</h2>
                    <div id="pebbles-list">
                        <!-- Pebbles will be populated by JavaScript -->
                    </div>
                </div>
                <div class="pond-container">
                    <div class="pond" id="pond">
                        <!-- Ripples and text will be added here by JavaScript -->
                    </div>
                </div>
            </div>
            
            <div class="controls">
                <button id="back-btn">Back to Scenarios</button>
                <button id="exit-ticket-btn" class="exit-ticket-btn">Exit Ticket</button>
                <button id="reset-btn" class="reset-btn">Reset Ripples</button>
            </div>
            <p class="instructions">Click on a cause to see its consequences ripple through history. Each ripple shows the timeline of interconnected events.</p>
        </div>

        <!-- Exit Ticket Screen -->
        <div id="exit-ticket-screen" class="screen">
            <div class="exit-ticket-container">
                <h2>Exit Ticket</h2>
                <div class="form-group">
                    <label for="student-name">Name:</label>
                    <input type="text" id="student-name" placeholder="Enter your name">
                </div>
                <div class="form-group">
                    <label for="key-question">Key Question:</label>
                    <p id="key-question">
                        "Select one historical scenario (like the Dust Bowl or Grand Coulee Dam) and one modern scenario (like Industrial Agriculture or the 'Green' Transition).
                        <br><br>
                        Based on what you saw in the lab, what is the single most important repeating pattern or lesson you see about the relationship between solving one problem (like needing food or energy) and creating new, unintended problems for people or the environment?"
                    </p>
                </div>
                <div class="form-group">
                    <label for="student-answer">Your Answer:</label>
                    <textarea id="student-answer" placeholder="Type your response here..."></textarea>
                </div>
                <div class="exit-ticket-controls">
                    <button id="back-from-exit-btn">Back to Lab</button>
                    <button id="print-btn" class="print-btn">Print / Save as PDF</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Enhanced Content with Dates and Better Context
        const content = {
            scenarios: [
                {
                    id: "gilded-age",
                    title: "The Gilded Age",
                    description: "Explore the environmental and social consequences of industrialization",
                    pebbles: [
                        {
                            title: "Unchecked Logging in Wisconsin (1860s-1870s)",
                            ripples: [
                                {
                                    date: "1860s-1870s",
                                    content: "Millions of acres of forest are clear-cut for lumber, leaving dry 'slash' (wood debris) that becomes highly flammable"
                                },
                                {
                                    date: "1871",
                                    content: "Boom towns like Peshtigo are built entirely from wood to support the lumber industry, creating dense communities in fire-prone areas"
                                },
                                {
                                    date: "October 8, 1871",
                                    content: "The Great Peshtigo Fire: A perfect storm of drought, high winds, and dry slash creates the deadliest fire in US history, killing 1,500-2,500 people and destroying entire ecosystems"
                                }
                            ]
                        }
                    ]
                },
                {
                    id: "great-depression",
                    title: "The Great Depression & Dust Bowl",
                    description: "Understand the interconnected causes of economic and environmental disaster",
                    pebbles: [
                        {
                            title: "Decades of Prairie Grass Destruction (1900-1930)",
                            ripples: [
                                {
                                    date: "1900-1930",
                                    content: "Native prairie grasses that anchored the soil for centuries are plowed under for wheat farming across the Great Plains"
                                },
                                {
                                    date: "1930-1934",
                                    content: "Severe drought hits the region. Without grass roots to hold it, topsoil turns to dust and creates massive 'black blizzards'"
                                },
                                {
                                    date: "1935-1940",
                                    content: "Dust Bowl conditions force 2.5 million people to abandon their farms. Many become 'Okies' migrating to California for work"
                                },
                                {
                                    date: "1930s",
                                    content: "Refugee camps called 'Hoovervilles' spring up nationwide, creating extreme poverty and social conflict that lasts for years"
                                }
                            ]
                        },
                        {
                            title: "Unregulated Bank Failures (1929-1933)",
                            ripples: [
                                {
                                    date: "1929-1933",
                                    content: "9,000 banks fail nationwide. Families lose their entire life savings with no deposit insurance"
                                },
                                {
                                    date: "1930-1932",
                                    content: "Consumer spending drops 50%. People stop buying cars, appliances, and other goods out of fear and necessity"
                                },
                                {
                                    date: "1933",
                                    content: "Factories mass-close due to lack of customers. Unemployment reaches 25% - 15 million Americans lose their jobs"
                                },
                                {
                                    date: "1930-1935",
                                    content: "Mass evictions create homeless populations. Breadlines form as poverty becomes widespread and visible"
                                }
                            ]
                        }
                    ]
                },
                {
                    id: "new-deal-rural",
                    title: "The New Deal - Rural Electrification",
                    description: "Trace the impacts of bringing electricity to rural America",
                    pebbles: [
                        {
                            title: "Rural Electrification Act of 1936",
                            ripples: [
                                {
                                    date: "1936",
                                    content: "REA provides low-cost loans to rural cooperatives to build electric grids where private companies won't invest"
                                },
                                {
                                    date: "1935-1950",
                                    content: "Rural electrification jumps from 10% to 90%. Farm families get electric lights, refrigeration, and radios for the first time"
                                },
                                {
                                    date: "Late 1930s-1940s",
                                    content: "Demand for electric appliances creates new industries and jobs. Rural quality of life improves dramatically"
                                },
                                {
                                    date: "1940s-1950s",
                                    content: "Massive new power sources are built, primarily hydroelectric dams and coal plants, creating new environmental impacts"
                                }
                            ]
                        }
                    ]
                },
                {
                    id: "new-deal-dams",
                    title: "The New Deal - Big Dam Projects",
                    description: "Examine the complex legacy of large-scale infrastructure projects",
                    pebbles: [
                        {
                            title: "Grand Coulee Dam Construction (1933-1942)",
                            ripples: [
                                {
                                    date: "1933-1942",
                                    content: "Thousands of unemployed workers get jobs through New Deal programs, providing crucial economic relief"
                                },
                                {
                                    date: "1942",
                                    content: "Dam completion permanently blocks salmon migration, devastating a food source that sustained communities for millennia"
                                },
                                {
                                    date: "1930s-1940s",
                                    content: "Ancestral fishing grounds of Indigenous tribes like the Colville are flooded, violating treaties and destroying cultural sites"
                                },
                                {
                                    date: "1940s-1950s",
                                    content: "Dam provides cheap electricity for WWII industries and irrigation for desert farming, but fundamentally alters the Columbia River ecosystem forever"
                                }
                            ]
                        }
                    ]
                },
                {
                    id: "modern-agriculture",
                    title: "Modern - Industrial Agriculture",
                    description: "Follow the chain of consequences from modern farming practices",
                    pebbles: [
                        {
                            title: "Industrial Monoculture Farming (1970s-Present)",
                            ripples: [
                                {
                                    date: "1970s-1980s",
                                    content: "Farm subsidies encourage fence-row to fence-row planting of corn/soybeans, relying heavily on chemical inputs"
                                },
                                {
                                    date: "1980s-Present",
                                    content: "Soil remains bare for much of the year without diverse root systems to anchor it, leading to erosion"
                                },
                                {
                                    date: "1990s-Present",
                                    content: "Topsoil erodes at alarming rates while chemical runoff creates massive 'Dead Zones' in the Gulf of Mexico"
                                },
                                {
                                    date: "2000s-Present",
                                    content: "While yields are high, soil degradation threatens long-term food security and requires ever-more expensive chemical inputs"
                                }
                            ]
                        }
                    ]
                },
                {
                    id: "green-transition",
                    title: "Modern - The 'Green' Transition",
                    description: "Explore the unintended consequences of transitioning to renewable energy",
                    pebbles: [
                        {
                            title: "Critical Minerals Rush (2010s-Present)",
                            ripples: [
                                {
                                    date: "2010s-Present",
                                    content: "Global push for EVs and batteries creates massive demand for lithium, cobalt, and copper"
                                },
                                {
                                    date: "2020s",
                                    content: "New mines open in sensitive areas like Thacker Pass (NV) and developing nations (Congo, Bolivia), often on Indigenous lands"
                                },
                                {
                                    date: "2020s",
                                    content: "Large-scale mining consumes vast water resources in arid regions and risks polluting local ecosystems"
                                },
                                {
                                    date: "Present",
                                    content: "The solution to climate crisis (caused by 20th-century extraction) creates new 21st-century extraction challenges, repeating historical patterns of environmental justice issues"
                                }
                            ]
                        }
                    ]
                }
            ]
        };

        // DOM Elements
        const introductionScreen = document.getElementById('introduction-screen');
        const startScreen = document.getElementById('start-screen');
        const pondScreen = document.getElementById('pond-screen');
        const exitTicketScreen = document.getElementById('exit-ticket-screen');
        const startLabBtn = document.getElementById('start-lab-btn');
        const scenarioList = document.getElementById('scenario-list');
        const scenarioTitle = document.getElementById('scenario-title');
        const pebblesList = document.getElementById('pebbles-list');
        const pond = document.getElementById('pond');
        const backBtn = document.getElementById('back-btn');
        const exitTicketBtn = document.getElementById('exit-ticket-btn');
        const resetBtn = document.getElementById('reset-btn');
        const backFromExitBtn = document.getElementById('back-from-exit-btn');
        const printBtn = document.getElementById('print-btn');

        // Current state
        let currentScenario = null;
        let activePebble = null;
        let activeRipples = [];

        // Initialize the application
        function init() {
            renderScenarios();
            setupEventListeners();
        }

        // Render scenario cards on the start screen
        function renderScenarios() {
            scenarioList.innerHTML = '';
            
            content.scenarios.forEach(scenario => {
                const scenarioCard = document.createElement('div');
                scenarioCard.className = 'scenario-card';
                scenarioCard.innerHTML = `
                    <h3>${scenario.title}</h3>
                    <p>${scenario.description}</p>
                `;
                
                scenarioCard.addEventListener('click', () => {
                    selectScenario(scenario.id);
                });
                
                scenarioList.appendChild(scenarioCard);
            });
        }

        // Set up event listeners
        function setupEventListeners() {
            startLabBtn.addEventListener('click', () => {
                introductionScreen.classList.remove('active');
                startScreen.classList.add('active');
            });
            
            pebblesList.addEventListener('click', e => {
                const pebbleItem = e.target.closest('.pebble-item');
                if (pebbleItem) {
                    const pebbleIndex = parseInt(pebbleItem.dataset.index);
                    selectPebble(pebbleIndex);
                }
            });
            
            backBtn.addEventListener('click', goBackToScenarios);
            exitTicketBtn.addEventListener('click', showExitTicket);
            resetBtn.addEventListener('click', resetRipples);
            backFromExitBtn.addEventListener('click', goBackToPond);
            printBtn.addEventListener('click', printExitTicket);
        }

        // Select a scenario and show the pond screen
        function selectScenario(scenarioId) {
            currentScenario = content.scenarios.find(s => s.id === scenarioId);
            
            if (!currentScenario) return;
            
            scenarioTitle.textContent = currentScenario.title;
            renderPebbles();
            
            startScreen.classList.remove('active');
            pondScreen.classList.add('active');
            
            resetRipples();
        }

        // Render pebbles for the current scenario
        function renderPebbles() {
            pebblesList.innerHTML = '';
            
            currentScenario.pebbles.forEach((pebble, index) => {
                const pebbleItem = document.createElement('div');
                pebbleItem.className = 'pebble-item';
                pebbleItem.dataset.index = index;
                pebbleItem.textContent = pebble.title;
                
                pebblesList.appendChild(pebbleItem);
            });
        }

        // Select a pebble and show its ripple effects
        function selectPebble(pebbleIndex) {
            resetRipples();
            
            const pebbleItems = document.querySelectorAll('.pebble-item');
            pebbleItems.forEach(item => item.classList.remove('active'));
            pebbleItems[pebbleIndex].classList.add('active');
            
            activePebble = currentScenario.pebbles[pebbleIndex];
            createRipples(activePebble.ripples);
        }

        // Create ripple animations and text with enhanced positioning
        function createRipples(rippleData) {
            const centerX = pond.offsetWidth / 2;
            const centerY = pond.offsetHeight / 2;
            let previousX = centerX;
            let previousY = centerY;
            
            rippleData.forEach((data, index) => {
                // Create ripple element
                const ripple = document.createElement('div');
                ripple.className = 'ripple';
                
                const size = 120 + (index * 100);
                ripple.style.width = `${size}px`;
                ripple.style.height = `${size}px`;
                ripple.style.left = `${centerX}px`;
                ripple.style.top = `${centerY}px`;
                
                // Create text element with date
                const textElement = document.createElement('div');
                textElement.className = 'ripple-text';
                textElement.innerHTML = `
                    <div class="ripple-date">${data.date}</div>
                    <div class="ripple-content">${data.content}</div>
                `;
                
                // Position text in a spiral pattern to avoid cutoff
                const angle = (index * 100) % 360;
                const radius = 120 + (index * 80);
                const textX = centerX + radius * Math.cos(angle * Math.PI / 180);
                const textY = centerY + radius * Math.sin(angle * Math.PI / 180);
                
                // Ensure text stays within bounds
                const boundedX = Math.max(140, Math.min(pond.offsetWidth - 140, textX));
                const boundedY = Math.max(100, Math.min(pond.offsetHeight - 100, textY));
                
                textElement.style.left = `${boundedX}px`;
                textElement.style.top = `${boundedY}px`;
                
                // Create timeline connector
                if (index > 0) {
                    const connector = document.createElement('div');
                    connector.className = 'timeline-connector';
                    const length = Math.sqrt(Math.pow(boundedX - previousX, 2) + Math.pow(boundedY - previousY, 2));
                    const connectorAngle = Math.atan2(boundedY - previousY, boundedX - previousX) * 180 / Math.PI;
                    
                    connector.style.width = `${length}px`;
                    connector.style.left = `${previousX}px`;
                    connector.style.top = `${previousY}px`;
                    connector.style.transform = `rotate(${connectorAngle}deg)`;
                    connector.style.transformOrigin = '0 0';
                    
                    pond.appendChild(connector);
                    activeRipples.push({element: connector});
                    
                    setTimeout(() => {
                        connector.classList.add('active');
                    }, index * 800);
                }
                
                previousX = boundedX;
                previousY = boundedY;
                
                // Add to pond
                pond.appendChild(ripple);
                pond.appendChild(textElement);
                activeRipples.push({element: ripple}, {element: textElement});
                
                // Animate with delay
                setTimeout(() => {
                    ripple.style.transition = 'all 2.5s ease-out';
                    ripple.style.opacity = '1';
                    ripple.style.transform = `translate(-50%, -50%) scale(1.8)`;
                    
                    textElement.classList.add('active');
                }, index * 1000);
                
                // Fade out ripple but keep text
                setTimeout(() => {
                    ripple.style.opacity = '0.3';
                }, (index * 1000) + 2500);
            });
        }

        // Reset all ripples
        function resetRipples() {
            activeRipples.forEach(({element}) => {
                if (element.parentNode) element.parentNode.removeChild(element);
            });
            activeRipples = [];
            
            const activePebbleItem = document.querySelector('.pebble-item.active');
            if (activePebbleItem) {
                activePebbleItem.classList.remove('active');
            }
            activePebble = null;
        }

        // Navigation functions
        function goBackToScenarios() {
            pondScreen.classList.remove('active');
            startScreen.classList.add('active');
            resetRipples();
            currentScenario = null;
        }

        function showExitTicket() {
            pondScreen.classList.remove('active');
            exitTicketScreen.classList.add('active');
        }

        function goBackToPond() {
            exitTicketScreen.classList.remove('active');
            pondScreen.classList.add('active');
        }

        function printExitTicket() {
            window.print();
        }

        // Initialize the application
        document.addEventListener('DOMContentLoaded', init);
    </script>
</body>
</html>
