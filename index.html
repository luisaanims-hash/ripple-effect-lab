<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>The Ripple Effect Lab</title>
    <style>
        /* ... (keep all existing CSS the same) ... */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        body {
            background: linear-gradient(to bottom, #1a3a5f, #2c5f8a);
            color: #fff;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 10px;
        }

        header {
            text-align: center;
            margin-bottom: 15px;
            width: 100%;
        }

        h1 {
            font-size: 2.2rem;
            margin-bottom: 8px;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.5);
        }

        .subtitle {
            font-size: 1.1rem;
            margin-bottom: 15px;
            opacity: 0.9;
        }

        .container {
            display: flex;
            flex-direction: column;
            width: 100%;
            max-width: 1400px;
            height: 85vh;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 15px;
            overflow: hidden;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
        }

        .screen {
            display: none;
            flex-direction: column;
            height: 100%;
            padding: 15px;
        }

        .active {
            display: flex;
        }

        /* ... (keep all other CSS exactly as before) ... */

        /* Add these new styles for enhanced exit ticket */
        .exit-ticket-controls {
            display: flex;
            justify-content: space-between;
            margin-top: 25px;
            gap: 15px;
        }

        .submit-btn {
            background: #9b59b6;
        }

        .submit-btn:hover {
            background: #8e44ad;
        }

        .nav-buttons {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin-top: 20px;
        }

        .modern-parallel {
            border-left: 4px solid #e74c3c !important;
        }

        .modern-parallel .ripple-date {
            color: #e74c3c !important;
        }
    </style>
    <!-- Add jsPDF library -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.28/jspdf.plugin.autotable.min.js"></script>
</head>
<body>
    <header>
        <h1>The Ripple Effect Lab</h1>
        <p class="subtitle">An Interactive Cause & Consequence Simulator</p>
    </header>

    <div class="container">
        <!-- Introduction Screen -->
        <div id="introduction-screen" class="screen active">
            <div class="intro-content">
                <h2>Welcome to The Ripple Effect Lab!</h2>
                <p>History isn't just a collection of dates and events—it's a complex web of <span class="highlight">causes and consequences</span> that ripple through time. In this interactive lab, you'll explore how single actions can create waves of change that transform societies, economies, and environments.</p>
                
                <p><span class="highlight">How does it work?</span></p>
                <ul>
                    <li><strong>Choose a historical scenario</strong> from periods like the Gilded Age, Great Depression, or modern challenges</li>
                    <li><strong>Drop "pebbles" (causes)</strong> into our virtual pond and watch the ripples unfold</li>
                    <li><strong>Follow the chain of consequences</strong> from immediate effects to long-term impacts</li>
                    <li><strong>Discover patterns</strong> that repeat across different historical periods</li>
                </ul>
                
                <p>By the end of this lab, you'll understand how solving one problem often creates new challenges—and how we can learn from history to make better decisions today.</p>
                
                <p><span class="highlight">Ready to see how your actions today might ripple into tomorrow?</span></p>
                
                <button class="start-lab-btn" id="start-lab-btn">Start Exploring History's Ripples</button>
            </div>
        </div>

        <!-- Start Screen -->
        <div id="start-screen" class="screen">
            <h2>Select a Historical Scenario</h2>
            <div class="scenario-list" id="scenario-list">
                <!-- Scenarios will be populated by JavaScript -->
            </div>
            <div class="nav-buttons">
                <button id="to-exit-ticket-from-start">Go to Exit Ticket</button>
            </div>
        </div>

        <!-- Pond Screen -->
        <div id="pond-screen" class="screen">
            <div class="pond-area">
                <div class="pebbles-panel">
                    <h2 id="scenario-title">Scenario Title</h2>
                    <div id="pebbles-list">
                        <!-- Pebbles will be populated by JavaScript -->
                    </div>
                </div>
                <div class="pond-container">
                    <div class="pond" id="pond">
                        <!-- Ripples and text will be added here by JavaScript -->
                    </div>
                </div>
            </div>
            
            <div class="controls">
                <button id="back-btn">Back to Scenarios</button>
                <button id="exit-ticket-btn" class="exit-ticket-btn">Exit Ticket</button>
                <button id="reset-btn" class="reset-btn">Reset Ripples</button>
            </div>
            <p class="instructions">Click on a cause to see its consequences ripple through history. Each ripple shows the timeline of interconnected events.</p>
        </div>

        <!-- Exit Ticket Screen -->
        <div id="exit-ticket-screen" class="screen">
            <div class="exit-ticket-container">
                <h2>Exit Ticket</h2>
                <div class="form-group">
                    <label for="student-name">Name:</label>
                    <input type="text" id="student-name" placeholder="Enter your name">
                </div>
                <div class="form-group">
                    <label for="student-id">Student ID (optional):</label>
                    <input type="text" id="student-id" placeholder="Enter student ID">
                </div>
                <div class="form-group">
                    <label for="key-question">Key Question:</label>
                    <p id="key-question">
                        "Select one historical scenario (like the Dust Bowl or Grand Coulee Dam) and one modern scenario (like Industrial Agriculture or the 'Green' Transition).
                        <br><br>
                        Based on what you saw in the lab, what is the single most important repeating pattern or lesson you see about the relationship between solving one problem (like needing food or energy) and creating new, unintended problems for people or the environment?"
                    </p>
                </div>
                <div class="form-group">
                    <label for="student-answer">Your Answer:</label>
                    <textarea id="student-answer" placeholder="Type your response here..."></textarea>
                </div>
                <div class="form-group">
                    <label for="historical-scenario">Historical Scenario Studied:</label>
                    <select id="historical-scenario">
                        <option value="">Select a historical scenario</option>
                        <option value="gilded-age">The Gilded Age</option>
                        <option value="great-depression">Great Depression & Dust Bowl</option>
                        <option value="new-deal-rural">New Deal - Rural Electrification</option>
                        <option value="new-deal-dams">New Deal - Big Dam Projects</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="modern-scenario">Modern Scenario Studied:</label>
                    <select id="modern-scenario">
                        <option value="">Select a modern scenario</option>
                        <option value="modern-agriculture">Modern Industrial Agriculture</option>
                        <option value="green-transition">Green Energy Transition</option>
                        <option value="tech-revolution">Digital Technology Revolution</option>
                        <option value="modern-infrastructure">Modern Infrastructure Development</option>
                    </select>
                </div>
                <div class="exit-ticket-controls">
                    <button id="back-from-exit-btn">Back to Lab</button>
                    <button id="submit-btn" class="submit-btn">Submit & Download PDF</button>
                    <button id="print-btn" class="print-btn">Print Only</button>
                </div>
                <div class="nav-buttons">
                    <button id="to-scenarios-from-exit">Back to Scenarios</button>
                    <button id="to-intro-from-exit">Back to Introduction</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Enhanced Content with More Scenarios and Modern Parallels
        const content = {
            scenarios: [
                {
                    id: "gilded-age",
                    title: "The Gilded Age",
                    description: "Explore the environmental and social consequences of industrialization",
                    pebbles: [
                        {
                            title: "Unchecked Logging in Wisconsin (1860s-1870s)",
                            ripples: [
                                {
                                    date: "1860s-1870s",
                                    content: "Millions of acres of forest are clear-cut for lumber, leaving dry 'slash' (wood debris) that becomes highly flammable"
                                },
                                {
                                    date: "1871",
                                    content: "Boom towns like Peshtigo are built entirely from wood to support the lumber industry, creating dense communities in fire-prone areas"
                                },
                                {
                                    date: "October 8, 1871",
                                    content: "The Great Peshtigo Fire: A perfect storm of drought, high winds, and dry slash creates the deadliest fire in US history, killing 1,500-2,500 people and destroying entire ecosystems"
                                }
                            ]
                        },
                        {
                            title: "Railroad Expansion & Land Grants (1860s-1890s)",
                            ripples: [
                                {
                                    date: "1862-1871",
                                    content: "Federal government grants 170 million acres to railroad companies to encourage transcontinental expansion"
                                },
                                {
                                    date: "1870s-1890s",
                                    content: "Railroads create massive fortunes for industrialists while displacing Native American tribes from their ancestral lands"
                                },
                                {
                                    date: "1880s-1900s",
                                    content: "Railroad monopolies lead to price discrimination against farmers, sparking the Populist movement and demands for regulation"
                                },
                                {
                                    date: "1890s",
                                    content: "Wealth concentration in railroad magnates contributes to extreme income inequality that characterizes the Gilded Age"
                                }
                            ]
                        },
                        {
                            title: "Modern Parallel: California Wildfires (2010s-2020s)",
                            modern: true,
                            ripples: [
                                {
                                    date: "2010-2020",
                                    content: "Population growth pushes development into wildfire-prone areas while climate change creates drier conditions"
                                },
                                {
                                    date: "2018",
                                    content: "PG&E power lines spark the Camp Fire, destroying Paradise, CA and killing 85 people - similar infrastructure risks as Peshtigo"
                                },
                                {
                                    date: "2020",
                                    content: "Record-breaking fire season burns 4.3 million acres in California, forcing mass evacuations and creating air quality crises"
                                },
                                {
                                    date: "2020s",
                                    content: "Utility companies face bankruptcy from liability, while insurance becomes unaffordable in high-risk areas, creating new economic challenges"
                                }
                            ]
                        }
                    ]
                },
                {
                    id: "great-depression",
                    title: "The Great Depression & Dust Bowl",
                    description: "Understand the interconnected causes of economic and environmental disaster",
                    pebbles: [
                        {
                            title: "Decades of Prairie Grass Destruction (1900-1930)",
                            ripples: [
                                {
                                    date: "1900-1930",
                                    content: "Native prairie grasses that anchored the soil for centuries are plowed under for wheat farming across the Great Plains"
                                },
                                {
                                    date: "1930-1934",
                                    content: "Severe drought hits the region. Without grass roots to hold it, topsoil turns to dust and creates massive 'black blizzards'"
                                },
                                {
                                    date: "1935-1940",
                                    content: "Dust Bowl conditions force 2.5 million people to abandon their farms. Many become 'Okies' migrating to California for work"
                                },
                                {
                                    date: "1930s",
                                    content: "Refugee camps called 'Hoovervilles' spring up nationwide, creating extreme poverty and social conflict that lasts for years"
                                }
                            ]
                        },
                        {
                            title: "Unregulated Bank Failures (1929-1933)",
                            ripples: [
                                {
                                    date: "1929-1933",
                                    content: "9,000 banks fail nationwide. Families lose their entire life savings with no deposit insurance"
                                },
                                {
                                    date: "1930-1932",
                                    content: "Consumer spending drops 50%. People stop buying cars, appliances, and other goods out of fear and necessity"
                                },
                                {
                                    date: "1933",
                                    content: "Factories mass-close due to lack of customers. Unemployment reaches 25% - 15 million Americans lose their jobs"
                                },
                                {
                                    date: "1930-1935",
                                    content: "Mass evictions create homeless populations. Breadlines form as poverty becomes widespread and visible"
                                }
                            ]
                        },
                        {
                            title: "Modern Parallel: 2008 Financial Crisis",
                            modern: true,
                            ripples: [
                                {
                                    date: "2000-2007",
                                    content: "Deregulation and complex financial instruments create a housing bubble similar to 1920s stock speculation"
                                },
                                {
                                    date: "2008",
                                    content: "Lehman Brothers collapse triggers global financial crisis, reminiscent of 1929 bank failures"
                                },
                                {
                                    date: "2008-2010",
                                    content: "Mass foreclosures and 8.7 million job losses create modern 'Hoovervilles' and economic desperation"
                                },
                                {
                                    date: "2010s",
                                    content: "Government bailouts and quantitative easing save system but create wealth inequality and political backlash like New Deal era"
                                }
                            ]
                        }
                    ]
                },
                {
                    id: "new-deal-rural",
                    title: "The New Deal - Rural Electrification",
                    description: "Trace the impacts of bringing electricity to rural America",
                    pebbles: [
                        {
                            title: "Rural Electrification Act of 1936",
                            ripples: [
                                {
                                    date: "1936",
                                    content: "REA provides low-cost loans to rural cooperatives to build electric grids where private companies won't invest"
                                },
                                {
                                    date: "1935-1950",
                                    content: "Rural electrification jumps from 10% to 90%. Farm families get electric lights, refrigeration, and radios for the first time"
                                },
                                {
                                    date: "Late 1930s-1940s",
                                    content: "Demand for electric appliances creates new industries and jobs. Rural quality of life improves dramatically"
                                },
                                {
                                    date: "1940s-1950s",
                                    content: "Massive new power sources are built, primarily hydroelectric dams and coal plants, creating new environmental impacts"
                                }
                            ]
                        },
                        {
                            title: "Modern Parallel: Digital Divide & AI Revolution",
                            modern: true,
                            ripples: [
                                {
                                    date: "1990s-2000s",
                                    content: "Internet access becomes essential, creating a 'digital divide' between connected urban and disconnected rural areas"
                                },
                                {
                                    date: "2010s",
                                    content: "Tech companies like Google dominate information access, similar to how electric companies initially served only profitable areas"
                                },
                                {
                                    date: "2020s",
                                    content: "AI tools become essential for education and work, creating new inequalities in access and skills"
                                },
                                {
                                    date: "2020s+",
                                    content: "Like REA, government initiatives attempt to provide broadband access, but face challenges of cost, infrastructure, and corporate resistance"
                                }
                            ]
                        }
                    ]
                }
                // ... (other scenarios remain the same)
            ]
        };

        // Database simulation using localStorage
        const ResponseDB = {
            init() {
                if (!localStorage.getItem('rippleLabResponses')) {
                    localStorage.setItem('rippleLabResponses', JSON.stringify([]));
                }
            },

            saveResponse(response) {
                const responses = JSON.parse(localStorage.getItem('rippleLabResponses'));
                responses.push({
                    ...response,
                    timestamp: new Date().toISOString(),
                    id: Date.now() + Math.random()
                });
                localStorage.setItem('rippleLabResponses', JSON.stringify(responses));
                return true;
            },

            getResponses() {
                return JSON.parse(localStorage.getItem('rippleLabResponses') || '[]');
            },

            exportData() {
                const responses = this.getResponses();
                const csv = this.convertToCSV(responses);
                this.downloadCSV(csv, 'ripple-lab-responses.csv');
            },

            convertToCSV(data) {
                if (data.length === 0) return '';
                const headers = Object.keys(data[0]);
                const csv = [
                    headers.join(','),
                    ...data.map(row => headers.map(header => {
                        const value = row[header] || '';
                        return `"${value.toString().replace(/"/g, '""')}"`;
                    }).join(','))
                ];
                return csv.join('\n');
            },

            downloadCSV(csv, filename) {
                const blob = new Blob([csv], { type: 'text/csv' });
                const url = window.URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = filename;
                a.click();
                window.URL.revokeObjectURL(url);
            }
        };

        // DOM Elements
        const introductionScreen = document.getElementById('introduction-screen');
        const startScreen = document.getElementById('start-screen');
        const pondScreen = document.getElementById('pond-screen');
        const exitTicketScreen = document.getElementById('exit-ticket-screen');
        const startLabBtn = document.getElementById('start-lab-btn');
        const scenarioList = document.getElementById('scenario-list');
        const scenarioTitle = document.getElementById('scenario-title');
        const pebblesList = document.getElementById('pebbles-list');
        const pond = document.getElementById('pond');
        const backBtn = document.getElementById('back-btn');
        const exitTicketBtn = document.getElementById('exit-ticket-btn');
        const resetBtn = document.getElementById('reset-btn');
        const backFromExitBtn = document.getElementById('back-from-exit-btn');
        const printBtn = document.getElementById('print-btn');
        const submitBtn = document.getElementById('submit-btn');
        const toExitTicketFromStart = document.getElementById('to-exit-ticket-from-start');
        const toScenariosFromExit = document.getElementById('to-scenarios-from-exit');
        const toIntroFromExit = document.getElementById('to-intro-from-exit');

        // Current state
        let currentScenario = null;
        let activePebble = null;
        let activeRipples = [];

        // Initialize the application
        function init() {
            ResponseDB.init();
            renderScenarios();
            setupEventListeners();
        }

        // Render scenario cards on the start screen
        function renderScenarios() {
            scenarioList.innerHTML = '';
            
            content.scenarios.forEach(scenario => {
                const scenarioCard = document.createElement('div');
                scenarioCard.className = 'scenario-card';
                scenarioCard.innerHTML = `
                    <h3>${scenario.title}</h3>
                    <p>${scenario.description}</p>
                    <small>${scenario.pebbles.length} cause${scenario.pebbles.length > 1 ? 's' : ''} to explore</small>
                `;
                
                scenarioCard.addEventListener('click', () => {
                    selectScenario(scenario.id);
                });
                
                scenarioList.appendChild(scenarioCard);
            });
        }

        // Set up event listeners
        function setupEventListeners() {
            startLabBtn.addEventListener('click', () => {
                introductionScreen.classList.remove('active');
                startScreen.classList.add('active');
            });
            
            pebblesList.addEventListener('click', e => {
                const pebbleItem = e.target.closest('.pebble-item');
                if (pebbleItem) {
                    const pebbleIndex = parseInt(pebbleItem.dataset.index);
                    selectPebble(pebbleIndex);
                }
            });
            
            // Navigation
            backBtn.addEventListener('click', goBackToScenarios);
            exitTicketBtn.addEventListener('click', showExitTicket);
            resetBtn.addEventListener('click', resetRipples);
            backFromExitBtn.addEventListener('click', goBackToPond);
            printBtn.addEventListener('click', printExitTicket);
            submitBtn.addEventListener('click', submitExitTicket);
            toExitTicketFromStart.addEventListener('click', showExitTicket);
            toScenariosFromExit.addEventListener('click', () => {
                exitTicketScreen.classList.remove('active');
                startScreen.classList.add('active');
            });
            toIntroFromExit.addEventListener('click', () => {
                exitTicketScreen.classList.remove('active');
                introductionScreen.classList.add('active');
            });

            // Teacher access to database (hidden feature)
            document.addEventListener('keydown', (e) => {
                if (e.ctrlKey && e.key === 'd') {
                    e.preventDefault();
                    ResponseDB.exportData();
                    alert('Response data exported as CSV');
                }
            });
        }

        // Select a scenario and show the pond screen
        function selectScenario(scenarioId) {
            currentScenario = content.scenarios.find(s => s.id === scenarioId);
            
            if (!currentScenario) return;
            
            scenarioTitle.textContent = currentScenario.title;
            renderPebbles();
            
            startScreen.classList.remove('active');
            pondScreen.classList.add('active');
            
            resetRipples();
        }

        // Render pebbles for the current scenario
        function renderPebbles() {
            pebblesList.innerHTML = '';
            
            currentScenario.pebbles.forEach((pebble, index) => {
                const pebbleItem = document.createElement('div');
                pebbleItem.className = `pebble-item ${pebble.modern ? 'modern-parallel' : ''}`;
                pebbleItem.dataset.index = index;
                pebbleItem.innerHTML = `
                    ${pebble.title}
                    ${pebble.modern ? '<br><small>Modern Parallel</small>' : ''}
                `;
                
                pebblesList.appendChild(pebbleItem);
            });
        }

        // Select a pebble and show its ripple effects
        function selectPebble(pebbleIndex) {
            resetRipples();
            
            const pebbleItems = document.querySelectorAll('.pebble-item');
            pebbleItems.forEach(item => item.classList.remove('active'));
            pebbleItems[pebbleIndex].classList.add('active');
            
            activePebble = currentScenario.pebbles[pebbleIndex];
            createRipples(activePebble.ripples);
        }

        // Create ripple animations and text with enhanced positioning
        function createRipples(rippleData) {
            const centerX = pond.offsetWidth / 2;
            const centerY = pond.offsetHeight / 2;
            let previousX = centerX;
            let previousY = centerY;
            
            rippleData.forEach((data, index) => {
                // Create ripple element
                const ripple = document.createElement('div');
                ripple.className = 'ripple';
                if (activePebble.modern) {
                    ripple.style.borderColor = 'rgba(231, 76, 60, 0.7)';
                }
                
                const size = 120 + (index * 100);
                ripple.style.width = `${size}px`;
                ripple.style.height = `${size}px`;
                ripple.style.left = `${centerX}px`;
                ripple.style.top = `${centerY}px`;
                
                // Create text element with date
                const textElement = document.createElement('div');
                textElement.className = `ripple-text ${activePebble.modern ? 'modern-parallel' : ''}`;
                textElement.innerHTML = `
                    <div class="ripple-date">${data.date}</div>
                    <div class="ripple-content">${data.content}</div>
                `;
                
                // Position text in a spiral pattern to avoid cutoff
                const angle = (index * 100) % 360;
                const radius = 120 + (index * 80);
                const textX = centerX + radius * Math.cos(angle * Math.PI / 180);
                const textY = centerY + radius * Math.sin(angle * Math.PI / 180);
                
                // Ensure text stays within bounds
                const boundedX = Math.max(140, Math.min(pond.offsetWidth - 140, textX));
                const boundedY = Math.max(100, Math.min(pond.offsetHeight - 100, textY));
                
                textElement.style.left = `${boundedX}px`;
                textElement.style.top = `${boundedY}px`;
                
                // Add to pond
                pond.appendChild(ripple);
                pond.appendChild(textElement);
                activeRipples.push({element: ripple}, {element: textElement});
                
                // Animate with delay
                setTimeout(() => {
                    ripple.style.transition = 'all 2.5s ease-out';
                    ripple.style.opacity = '1';
                    ripple.style.transform = `translate(-50%, -50%) scale(1.8)`;
                    
                    textElement.classList.add('active');
                }, index * 1000);
                
                // Fade out ripple but keep text
                setTimeout(() => {
                    ripple.style.opacity = '0.3';
                }, (index * 1000) + 2500);
            });
        }

        // Reset all ripples
        function resetRipples() {
            activeRipples.forEach(({element}) => {
                if (element.parentNode) element.parentNode.removeChild(element);
            });
            activeRipples = [];
            
            const activePebbleItem = document.querySelector('.pebble-item.active');
            if (activePebbleItem) {
                activePebbleItem.classList.remove('active');
            }
            activePebble = null;
        }

        // Navigation functions
        function goBackToScenarios() {
            pondScreen.classList.remove('active');
            startScreen.classList.add('active');
            resetRipples();
            currentScenario = null;
        }

        function showExitTicket() {
            pondScreen.classList.remove('active');
            exitTicketScreen.classList.add('active');
        }

        function goBackToPond() {
            exitTicketScreen.classList.remove('active');
            pondScreen.classList.add('active');
        }

        function printExitTicket() {
            window.print();
        }

        // Enhanced Exit Ticket Submission
        async function submitExitTicket() {
            const studentName = document.getElementById('student-name').value;
            const studentId = document.getElementById('student-id').value;
            const studentAnswer = document.getElementById('student-answer').value;
            const historicalScenario = document.getElementById('historical-scenario').value;
            const modernScenario = document.getElementById('modern-scenario').value;

            if (!studentName || !studentAnswer || !historicalScenario || !modernScenario) {
                alert('Please fill in all required fields: Name, Answer, and both scenario selections.');
                return;
            }

            // Save to database
            const response = {
                studentName,
                studentId,
                answer: studentAnswer,
                historicalScenario,
                modernScenario,
                submissionDate: new Date().toLocaleDateString()
            };

            if (ResponseDB.saveResponse(response)) {
                // Generate and download PDF
                await generatePDF(response);
                alert('Response submitted successfully! PDF downloaded.');
                
                // Clear form
                document.getElementById('student-name').value = '';
                document.getElementById('student-id').value = '';
                document.getElementById('student-answer').value = '';
                document.getElementById('historical-scenario').value = '';
                document.getElementById('modern-scenario').value = '';
            } else {
                alert('Error saving response. Please try again.');
            }
        }

        // PDF Generation
        async function generatePDF(response) {
            const { jsPDF } = window.jspdf;
            const doc = new jsPDF();
            
            // Title
            doc.setFontSize(20);
            doc.text('The Ripple Effect Lab - Exit Ticket', 20, 30);
            
            // Student info
            doc.setFontSize(12);
            doc.text(`Student Name: ${response.studentName}`, 20, 50);
            if (response.studentId) {
                doc.text(`Student ID: ${response.studentId}`, 20, 60);
            }
            doc.text(`Submission Date: ${response.submissionDate}`, 20, 70);
            
            // Scenarios studied
            doc.text(`Historical Scenario: ${document.getElementById('historical-scenario').options[document.getElementById('historical-scenario').selectedIndex].text}`, 20, 85);
            doc.text(`Modern Scenario: ${document.getElementById('modern-scenario').options[document.getElementById('modern-scenario').selectedIndex].text}`, 20, 95);
            
            // Question and answer
            doc.setFontSize(14);
            doc.text('Key Question:', 20, 115);
            doc.setFontSize(10);
            const question = "Select one historical scenario and one modern scenario. Based on what you saw in the lab, what is the single most important repeating pattern or lesson you see about the relationship between solving one problem and creating new, unintended problems for people or the environment?";
            const splitQuestion = doc.splitTextToSize(question, 170);
            doc.text(splitQuestion, 20, 125);
            
            doc.setFontSize(14);
            doc.text('Student Response:', 20, 155);
            doc.setFontSize(11);
            const splitAnswer = doc.splitTextToSize(response.answer, 170);
            doc.text(splitAnswer, 20, 165);
            
            // Footer
            doc.setFontSize(8);
            doc.text('Generated by The Ripple Effect Lab - Understanding Cause and Consequence Through History', 20, 280);
            
            // Download PDF
            doc.save(`RippleEffectLab-${response.studentName}-${response.submissionDate}.pdf`);
        }

        // Initialize the application
        document.addEventListener('DOMContentLoaded', init);
    </script>
</body>
</html>
